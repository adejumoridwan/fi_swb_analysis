---
title: "Data Cleaning"
author: "Adejumo  Ridwan Suleiman"
format: html
---

```{r}
library(tidyverse)
library(haven)
library(psych)
library(mice)
library(FactoMineR)
library(mice)
library(factoextra)
```

```{r}
mics <- read_csv("datasets/mics_imputed.csv")
skimr::skim(mics)
```

```{r}
columns_to_exclude = c("HH1", "HH2", "wmweight", "PSU", "stratum", "HHAGE")

mics <- mics %>%
  mutate(across(-all_of(columns_to_exclude), as.ordered))
```

```{r}
skimr::skim(mics)
```


```{r}
# Load necessary libraries
library(FactoMineR)
library(tibble)

# Define the function
perform_mca <- function(data, n_comp = 1, comp_name = "Component") {
  # Perform MCA
  mca_result <- MCA(data, ncp = n_comp, graph = FALSE)
  
  # Extract the component scores for individuals
  component_scores <- mca_result$ind$coord[, n_comp]
  
  # Convert to tibble with specified column name and return
  component_tibble <- tibble(!!comp_name := component_scores)
  
  return(component_tibble)
}


```


## Financial Inclusion awareness

```{r}
subset = mics |> 
  select(FN1A:FN2)

FIA = perform_mca(subset, 1,"FIA")
```

## Financial Inclusion usage

```{r}
subset = mics |> 
  select(FN2:FN5)

FIU = perform_mca(subset, 1,"FIU")
```

## Usage of Electronic and Print Information

```{r}
subset = mics |> 
  select(MT1, MT2, MT3, MT4, MT5, MT9, MT10, MT11, MT12)

WEU = perform_mca(subset, 1,"WEU")
```

## Feelings of Safety
```{r}
subset = mics |> 
  select(VT20, VT21, VT22A, VT22B, VT22C, VT22D, VT22E, VT22F, VT22X)

WFS = perform_mca(subset, 1,"WFS")
```

## Feelings of Abuse

```{r}
subset = mics |> 
  select(DV1A, DV1B, DV1C, DV1D, DV1F)

WFA = perform_mca(subset, 1,"WFA")
```

## Household Ownership of print and electronic information 

```{r}
subset = mics |> 
  select(HC7A, HC7B, HC9A, HC11, HC12, HC13)

HOE = perform_mca(subset, 1,"HOE")
```

## Awarenesss of Financial Inclusion Programs

```{r}
subset = mics |> 
  select(ST2_1, ST2_2, ST2_3, ST2_4)

AFIP = perform_mca(subset, 1,"AFIP")
```

## Usage of Finacial Inclusion Programs
```{r}
subset = mics |> 
  select(ST2_1, ST2_2, ST2_3, ST2_4)

UFIP = perform_mca(subset, 1,"UFIP")
```


```{r}
mics <- bind_cols(mics, FIA, FIU, WEU, WFS, WFA, HOE, AFIP, UFIP)
```

```{r}
write_dta(mics, "datasets/mics.dta")
```


